<!DOCTYPE html>
<html>
<head>
<title>APT User Guide</title>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" 
href="styles/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" 
href="styles/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" 
href="styles/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" 
media="projection" href="styles/projection.css">

<style type="text/css">
strong.regular-font {
  font-family: Arial, Lucida Grande, sans-serif;
  font-style: italic;
  font-size: 0.9em;
}
</style>

</head>

<body>
<h1><a href="index.html">APT</a> User Guide</h1>

APT:  Predicts the location of body parts based on part labels from a set of video frames. 
 
<p> APT takes video files as inputs (with optional tracking files), and the user interactively trains a body part classifier by labeling a user-specified number of body part locations. </p>

APT is being developed by Kristin Branson, Mayank Kabra, Allen Lee, Alice Robie, and Felipe Rodriguez.  All work is funded by the Howard Hughes Medical Institute and the Janelia Research Campus. 

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License (version 3 pasted at the end) for more details.

<hr class="h2-divider">

<h2>Contents</h2>

<ul>
<li><a href="#Download">Download</a></li>
<li><a href="#Install">Install</a></li>
<li><a href="#Startup">Start-up</a></li>
<li><a href="#Setting up a new project">Setting up a new project</a></li>
<li><a href="#Opening an existing project">Opening an existing project</a></li>
<li><a href="#Navigating in APT">Navigating in APT</a></li>

<li><a href="#Labeling points">Labeling points</a></li>


</ul>

<hr class="h2-divider">

<h2><a id="Download">Download</a></h2>

<p>
The git repository for APT is hosted on <a href="https://github.com/kristinbranson/APT">github</a>. 
</p>
<p>
Compiled binaries and source code releases are available <a href="https://github.com/kristinbranson/APT/releases">here</a>.
</p>

APT also requires the following:
JAABA, available <a href="https://github.com/kristinbranson/JAABA"> here </a>, and Piotr Dollar's toolbox, available <a href="https://github.com/pdollar/toolbox"> here </a>
<br>
If you are working with multi-camera data, you may need calibration software for your rig, e.g <a href="https://www.vision.caltech.edu/bouguetj/calib_doc/"> Caltech camera calibration toolbox </a>
<br>

<hr class="h2-divider">

<h2><a id="Install">Install</a></h2>

In the APT directory, copy Manifest.sample.txt  to Manifest.txt and edit to point to your copy of JAABA and Piotr's toolbox (specify the root directory, which contains the subfolders filehandling/ and misc/, 
e.g. jaaba, c:\pgms\jaaba
	piotr, c:\pgms\pdollar_toolbox).
 
NOTE: In Manifest.sample.txt there is also a path to camera/calibration/toolbox, if you are not using multi-camera it is OK to not include this line.



<hr class="h2-divider">

<h2><a id="Startup">Start-up</a></h2>

APT is a MATLAB-based program. To run it:
<ol>
<li> Start MATLAB. </li>
<li> Within MATLAB, change into the directory containing the APT code:
<pre>>> cd APT;</pre>
</li>

<li> Run APT.setpath: </li>
<pre>>> APT.setpath; </pre>

<li> Run <b>StartAPT</b> on the command line to start APT:
<pre>>> StartAPT;</pre>
</li>
</ol>

<hr class="h2-divider">

<h2><a id="Setting up a new project"> Setting up a new project </a></h2>
File -> New Project, enter a project name. Track -> Configure tracking parameters.  This pops up a window with parameters to set. If you click on a parameter, a description of the parameter shows up at the bottom of the window. Click Apply. Go to File -> Manage movies and select the movie that you would like to work with. You will be prompted for a trx file. Select a trx file, or, if none, press “cancel”. Close or minimize the Movie window. Go to File -> Save as and save your project. This will save a .lbl file with your project in it.

<hr class="h2-divider">

<h2><a id="Opening an existing project"> Opening an existing project </a></h2>

File -> Load Project, select the .lbl file to load. If the locations of the movies in the project has changed since you last opened the project it will prompt for their new locations.  

<hr class="h2-divider">

<h2><a id="Navigating in APT"> Navigating in APT </a></h2>

a/d, -/=, or the left and right arrow keys all move one frame left/right respectively. Using these keys while holding down the ctrl button uses 10 frames steps. You can also navigate using the mouse and the navigation bar under the image.  Clicking on the bar to the left or right of the slider jumps by 100 frames.  Single clicks on the arrows at the ends of the navigation bar moves by a single frame.  Holding the end arrows down steps through the movie a frame at a time. To look at only labeled frames, hold the shift button while using the right and left arrow keys.
<br>
<br>
Useful view options for multi-target projects with tracking and orientation:<br>
View -> Center on target  - keeps current target in the center<br>
View -> Rotate video so target is always pointing up<br>
View -> Zoom out/full images or unzoom button - view full image
Use slider bar above ‘unzoom’ to adjust zoom not the magnifier +/- <br>
Zoom slider bar - adjust zoom then ‘set’, ‘recall’ will change back to ‘set’ value after changing movies. 


<hr class="h2-divider">

<h2><a id="Labeling points"> Labeling points </a></h2>

Labeling modes:
There are different labeling modes, which you can switch between under Setup->. 

<ol>
<li>Sequential mode:
Allows you to just click your points in order, and then accept when you’re done. 
You can edit placement after you finish clicking sequence by:
<ul>
<li>Clicking and dragging a point</li>
<li>Activating a point with a number key that corresponds to the label number and then clicking the correct location for the label. Activated points change from ‘+’ to ‘x’ (Numbers above 10 are accessed by `(back quote) + number key).</li>
<li>Activating a point with the number keys and moving with arrow keys. </li> 
Currently the only way to ‘un-activate’ label is to move the label to new location or accept labels.
</ul>
</li>

<li>Template mode:
Each frame will have unassigned label points in random locations on the image (white pluses with colored numbers next to them).  To label the frame, move the pluses to where they should belong on the target (mouse/fly).  You can drag and drop a point with the mouse or you can select (or unselect) a point with its associated number key (1-9).  When a point is selected it changes from a plus to an x.  A selected point can be moved using the arrow keys (helpful for fine-tuning positions).  Shift plus the arrow keys moves the selected point in larger jumps.  When a point is selected, a mouse click anywhere on the image will move the selected point to that location.
</li>
</ol>

Once you are happy with the positions of the points, click the accept button, or press the “s” key or the space bar to save the labels for the current frame.  
<br> <br>
<b>Make sure to press the accept button at each frame once you are done or your changes will not be recorded.</b>
<p>
Once you have a reasonable number of frames labeled you are ready to train a classifier.</p>

To remove frames (useful for making a subset, or if you change your mind about how something will be labeled), you can just click the “Clear” button on that frame (next to the Accepted button), and those points will go back to unassigned.

<p>To just look at labeled frames, holding the shift button while using the right and left arrow keys will move through only the labeled frames, skipping the unlabeled ones. </p>



<hr class="h2-divider">

<h2><a id="Training"> Training </a></h2>

<ol>
<li>Set the tracking parameters:
Track->Configure tracking parameters</li>
</ol>


What displays will depend on what type of tracking you are using.  Clicking on each option will produce a description of that option at the bottom of the page. Note that many of the default options are selections from dropdown menus, click the current option to see the other options. <a href="tracking_parameters.html"> Detailed tracking parameters. </a>
<p>Once you have set the parameters to what you would like, hit the Apply button.</p>



<footer>
<hr class="h1-divider">
<center>
<a href="index.html">APT Documentation Home</a> | <a href="https://www.janelia.org/lab/branson-lab">Branson Lab</a> | <i>Last Updated June 5, 2018</i>
</center>
</footer>

</body>
